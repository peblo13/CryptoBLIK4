<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¤– Auto-Tester Plan Synchronization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #00ff00;
        }
        .error { border-color: #ff0000; color: #ff0000; }
        .warning { border-color: #ffaa00; color: #ffaa00; }
        .success { border-color: #00ff00; color: #00ff00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 25px;
            margin: 10px 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
        }
        button:hover { background: #00cc00; }
        .test-result {
            background: #0a0a0a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
        }
        .big-button {
            font-size: 20px;
            padding: 20px 30px;
            margin: 20px 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– Auto-Tester Plan Synchronization</h1>
        
        <div class="status">
            <h3>ğŸ¯ Automatyczne wykrywanie problemu synchronizacji planÃ³w</h3>
            <p>Ten tester automatycznie wykryje czy wystÄ™puje problem z synchronizacjÄ… planÃ³w miÄ™dzy rÃ³Å¼nymi elementami.</p>
        </div>
        
        <div style="text-align: center;">
            <button class="big-button" onclick="runFullAutoTest()">
                ğŸš€ URUCHOM PEÅNY AUTOTEST
            </button>
        </div>
        
        <div class="status">
            <h3>ğŸ“Š Wyniki testÃ³w:</h3>
            <div id="testResults">NaciÅ›nij przycisk aby uruchomiÄ‡ testy...</div>
        </div>
        
        <div class="status">
            <h3>ğŸ”§ RÄ™czne testy:</h3>
            <button onclick="testBasicSync()">Test podstawowej synchronizacji</button>
            <button onclick="testRapidChanges()">Test szybkich zmian</button>
            <button onclick="testConflicts()">Test konfliktÃ³w</button>
            <button onclick="openMainPage()">ğŸ“„ OtwÃ³rz gÅ‚Ã³wnÄ… stronÄ™</button>
        </div>
        
        <div class="status">
            <h3>ğŸ“‹ Logi testÃ³w:</h3>
            <div id="testLogs" class="test-result">Logi bÄ™dÄ… tutaj...</div>
        </div>
    </div>

    <script>
        let testLogs = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testLogs.push({message: logEntry, type});
            
            const logsDiv = document.getElementById('testLogs');
            logsDiv.innerHTML = testLogs.map(l => {
                const color = l.type === 'error' ? '#ff0000' : 
                             l.type === 'warning' ? '#ffaa00' : 
                             l.type === 'success' ? '#00ff00' : '#ffffff';
                return `<div style="color: ${color}">${l.message}</div>`;
            }).join('');
            
            console.log(logEntry);
        }
        
        function updateResults(html) {
            document.getElementById('testResults').innerHTML = html;
        }
        
        async function runFullAutoTest() {
            log('ğŸš€ Rozpoczynam peÅ‚ny autotest...', 'info');
            updateResults('<div style="color: #ffaa00;">â³ Trwa testowanie...</div>');
            
            let allTestsPassed = true;
            let results = [];
            
            // Test 1: SprawdÅº czy sessionStorage dziaÅ‚a
            try {
                sessionStorage.setItem('test', 'value');
                const val = sessionStorage.getItem('test');
                sessionStorage.removeItem('test');
                if (val === 'value') {
                    results.push('âœ… SessionStorage: OK');
                    log('âœ… Test sessionStorage: PASSED', 'success');
                } else {
                    throw new Error('SessionStorage nie dziaÅ‚a');
                }
            } catch (e) {
                results.push('âŒ SessionStorage: BÅÄ„D - ' + e.message);
                log('âŒ Test sessionStorage: FAILED - ' + e.message, 'error');
                allTestsPassed = false;
            }
            
            // Test 2: SprawdÅº czy moÅ¼na utworzyÄ‡ elementy DOM
            try {
                const testDiv = document.createElement('div');
                testDiv.id = 'testElement';
                document.body.appendChild(testDiv);
                const found = document.getElementById('testElement');
                document.body.removeChild(testDiv);
                
                if (found) {
                    results.push('âœ… DOM manipulation: OK');
                    log('âœ… Test DOM: PASSED', 'success');
                } else {
                    throw new Error('Nie moÅ¼na manipulowaÄ‡ DOM');
                }
            } catch (e) {
                results.push('âŒ DOM manipulation: BÅÄ„D - ' + e.message);
                log('âŒ Test DOM: FAILED - ' + e.message, 'error');
                allTestsPassed = false;
            }
            
            // Test 3: Symulacja problemu z planami
            try {
                // StwÃ³rz tymczasowe elementy jak w gÅ‚Ã³wnej stronie
                const userWelcome = document.createElement('div');
                const userPlan = document.createElement('div');
                userWelcome.id = 'tempUserWelcome';
                userPlan.id = 'tempUserPlan';
                document.body.appendChild(userWelcome);
                document.body.appendChild(userPlan);
                
                // Ustaw dane Premium
                sessionStorage.setItem('currentUser', JSON.stringify({
                    name: 'Test User',
                    email: 'test@example.com',
                    plan: 'Premium'
                }));
                
                // Symuluj funkcjÄ™ synchronizacji
                const userData = sessionStorage.getItem('currentUser');
                const user = JSON.parse(userData);
                
                userWelcome.innerHTML = `<span>ğŸ‘‹ Witaj, ${user.name}!</span>`;
                userPlan.innerHTML = `<span>ğŸ“‹ â­ ${user.plan}</span>`;
                
                // SprawdÅº czy elementy zawierajÄ… wÅ‚aÅ›ciwe dane
                if (userWelcome.innerHTML.includes('Test User') && 
                    userPlan.innerHTML.includes('Premium')) {
                    results.push('âœ… Synchronizacja Premium: OK');
                    log('âœ… Test synchronizacji Premium: PASSED', 'success');
                } else {
                    throw new Error('Synchronizacja nie dziaÅ‚a poprawnie');
                }
                
                // Test zmiany planu
                const newUserData = JSON.parse(userData);
                newUserData.plan = 'Enterprise';
                sessionStorage.setItem('currentUser', JSON.stringify(newUserData));
                
                // Symuluj ponownÄ… synchronizacjÄ™
                const newData = JSON.parse(sessionStorage.getItem('currentUser'));
                userPlan.innerHTML = `<span>ğŸ“‹ ğŸ’ ${newData.plan}</span>`;
                
                if (userPlan.innerHTML.includes('Enterprise')) {
                    results.push('âœ… Zmiana planu Enterprise: OK');
                    log('âœ… Test zmiany na Enterprise: PASSED', 'success');
                } else {
                    throw new Error('Zmiana planu nie dziaÅ‚a');
                }
                
                // SprawdÅº czy nie ma niezgodnoÅ›ci
                const welcomeText = userWelcome.innerHTML;
                const planText = userPlan.innerHTML;
                
                if (welcomeText.includes('Test User') && planText.includes('Enterprise')) {
                    results.push('âœ… ZgodnoÅ›Ä‡ danych: OK');
                    log('âœ… Test zgodnoÅ›ci: PASSED', 'success');
                } else {
                    results.push('âš ï¸ POTENCJALNY PROBLEM: NiezgodnoÅ›Ä‡ danych!');
                    log('âš ï¸ POTENCJALNY PROBLEM wykryty!', 'warning');
                    allTestsPassed = false;
                }
                
                // Cleanup
                document.body.removeChild(userWelcome);
                document.body.removeChild(userPlan);
                sessionStorage.removeItem('currentUser');
                
            } catch (e) {
                results.push('âŒ Test synchronizacji: BÅÄ„D - ' + e.message);
                log('âŒ Test synchronizacji: FAILED - ' + e.message, 'error');
                allTestsPassed = false;
            }
            
            // Test 4: SprawdÅº czy gÅ‚Ã³wna strona istnieje
            try {
                const img = new Image();
                img.onload = () => {
                    results.push('âœ… GÅ‚Ã³wna strona: DostÄ™pna');
                    log('âœ… GÅ‚Ã³wna strona: DostÄ™pna', 'success');
                };
                img.onerror = () => {
                    results.push('âš ï¸ GÅ‚Ã³wna strona: MoÅ¼e byÄ‡ problem z dostÄ™pem');
                    log('âš ï¸ Problem z dostÄ™pem do gÅ‚Ã³wnej strony', 'warning');
                };
                img.src = 'file:///c:/serwer/htdocs/moj_projek/eCVjob.pl/src/baza_cv_new.html';
            } catch (e) {
                results.push('âŒ GÅ‚Ã³wna strona: BÅÄ„D - ' + e.message);
                log('âŒ Test gÅ‚Ã³wnej strony: FAILED - ' + e.message, 'error');
            }
            
            // Podsumowanie
            const finalResult = allTestsPassed ? 
                '<div style="color: #00ff00; font-size: 18px;">ğŸ‰ WSZYSTKIE TESTY PRZESZÅY POMYÅšLNIE!</div>' :
                '<div style="color: #ff0000; font-size: 18px;">âš ï¸ WYKRYTO PROBLEMY - sprawdÅº logi</div>';
            
            results.push('');
            results.push(finalResult);
            
            updateResults(results.join('<br>'));
            log(`ğŸ Autotest zakoÅ„czony. Wynik: ${allTestsPassed ? 'SUCCESS' : 'PROBLEMS FOUND'}`, 
                allTestsPassed ? 'success' : 'error');
        }
        
        function testBasicSync() {
            log('ğŸ”„ Test podstawowej synchronizacji...', 'info');
            
            // Ustaw dane testowe
            sessionStorage.setItem('currentUser', JSON.stringify({
                name: 'Test User',
                email: 'test@example.com',
                plan: 'Premium'
            }));
            
            log('âœ… Ustawiono dane Premium w sessionStorage', 'success');
            log('ğŸ’¡ Teraz otwÃ³rz gÅ‚Ã³wnÄ… stronÄ™ i sprawdÅº czy wyÅ›wietla siÄ™ Premium', 'info');
        }
        
        function testRapidChanges() {
            log('âš¡ Test szybkich zmian planu...', 'info');
            
            const plans = ['Premium', 'Business', 'Enterprise'];
            let currentPlan = 0;
            
            const interval = setInterval(() => {
                const plan = plans[currentPlan];
                sessionStorage.setItem('currentUser', JSON.stringify({
                    name: 'Test User',
                    email: 'test@example.com',
                    plan: plan
                }));
                
                log(`ğŸ”„ Zmieniono plan na: ${plan}`, 'info');
                currentPlan++;
                
                if (currentPlan >= plans.length) {
                    clearInterval(interval);
                    log('âœ… Test szybkich zmian zakoÅ„czony', 'success');
                }
            }, 1000);
        }
        
        function testConflicts() {
            log('âš ï¸ Test konfliktÃ³w - symulacja problemu...', 'warning');
            
            // Ustaw Premium
            sessionStorage.setItem('currentUser', JSON.stringify({
                name: 'Test User',
                email: 'test@example.com',
                plan: 'Premium'
            }));
            
            log('1. Ustawiono Premium', 'info');
            
            setTimeout(() => {
                // ZmieÅ„ na Enterprise
                sessionStorage.setItem('currentUser', JSON.stringify({
                    name: 'Test User',
                    email: 'test@example.com',
                    plan: 'Enterprise'
                }));
                
                log('2. Zmieniono na Enterprise - sprawdÅº gÅ‚Ã³wnÄ… stronÄ™!', 'warning');
            }, 2000);
        }
        
        function openMainPage() {
            const url = 'file:///c:/serwer/htdocs/moj_projek/eCVjob.pl/src/baza_cv_new.html';
            window.open(url, '_blank');
            log('ğŸ“„ Otwarto gÅ‚Ã³wnÄ… stronÄ™ w nowym oknie', 'info');
        }
        
        // Auto-start
        log('ğŸ¤– Auto-tester zaÅ‚adowany i gotowy!', 'success');
        log('ğŸ’¡ NaciÅ›nij "URUCHOM PEÅNY AUTOTEST" aby rozpoczÄ…Ä‡', 'info');
    </script>
</body>
</html>
